<html>
	<head>
		{% load staticfiles %} {% block main %} {% load ehcofilter %}
		<title>{% settings_value "TITLE" %}</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
		<link rel="stylesheet" href="{% static 'sspanel/css/main.css' %}" />
		<!--[if lte IE 9]><link rel="stylesheet" href="assets/css/ie9.css" /><![endif]-->
		<noscript><link rel="stylesheet" href="{% static 'sspanel/css/noscript.css' %}" /></noscript>
	</head>
	<body>
		<!-- Wrapper -->
        <div id="wrapper">
            <!-- Header -->
            <div class="column is-12">
                <section class="hero is-success is-smaill">
                    <div class="hero-body">
                        <div class="container">
                            <h1 class="title">
                                节点列表
                            </h1>
                            <div class="subtitle">
                                请勿传播地址，<strong><a href="http://shell.oss-cn-hongkong.aliyuncs.com/setup.exe">客户端下载</a></strong>
                            </div>
                        </div>
                    </div>
                </section>
            </div>

            <div class="column is-12">
                <div class="box nodelist" id="id-nodelist">
                    {% for list in nodelists %}
                    <div class="node-cell" data-id="{{ list.node_id }}">
                        <div class="card">
                            <div class="card-header">
                                {% if list.online == True %}
                                <p class="card-header-title">
                                    <span class="tag is-success">在线</span>&nbsp&nbsp{{ list.name }}</p>
                                {% else %}
                                <p class="card-header-title">
                                    <span class="tag is-danger">掉线</span>&nbsp&nbsp{{ list.name }}</p>
                                {% endif %}
                            </div>
                            <div class="card-content">
                                <div class="content">
                                    {{ list.info }}
                                </div>
                            </div>
                            <div class="card-footer">
                                <a class="card-footer-item">人数:「{{ list.count }}」</a>
                                <a class="card-footer-item">状态: 「{{ list.status }}」</a>
                            </div>
                        </div>

                        <div class="modal nodeinfo" id="modal-{{ list.node_id }}">
                            <div class="modal-background"></div>
                            <div class="modal-card">
                                <header class="modal-card-head">
                                    <p class="modal-card-title">节点配置信息:</p>
                                </header>
                                <section class="modal-card-body">
                                    <table class="table is-fullwidth is-bordered is-striped ">
                                        </p>
                                        <tr>
                                            <td class="notification">节点ip:</td>
                                            <td class="notification">{{ list.server }}</td>
                                        </tr>
                                        <tr>
                                            <td class="notification">端口:</td>
                                            <td class="notification">{{ ss_user.port }}</td>
                                        </tr>
                                        <tr>
                                            <td class="notification">密码:</td>
                                            <td class="notification">{{ ss_user.password }}</td>
                                        </tr>
                                        {% if list.custom_method == 0 %}
                                        <tr>
                                            <td class="notification">加密方式:</td>
                                            <td class="notification">{{ list.method }}</td>
                                        </tr>
                                        <tr>
                                            <td class="notification">协议(ss版客户端可不填写):</td>
                                            <td class="notification">{{ list.protocol }}</td>
                                        </tr>
                                        <tr>
                                            <td class="notification">混淆(ss版客户端可不填写):</td>
                                            <td class="notification">{{ list.obfs }}</td>
                                        </tr>
                                        {% else %}
                                        <tr>
                                            <td class="notification">加密方式:</td>
                                            <td class="notification">{{ ss_user.method }}</td>
                                        </tr>
                                        <tr>
                                            <td class="notification">协议(ss版客户端可不填写):</td>
                                            <td class="notification">{{ ss_user.protocol }}</td>
                                        </tr>
                                        <tr>
                                            <td class="notification">混淆(ss版客户端可不填写):</td>
                                            <td class="notification">{{ ss_user.obfs }}</td>
                                        </tr>
                                        {% endif %}
                                    </table>
                                    <p class="subtitle">配置链接：</p>
                                    <a href={{ list.sslink }}>手机上用默认浏览器打开点我就可以直接添加配置(SS版)</a>
                                    <br>
                                    <a href={{ list.ssrlink }}>手机上用默认浏览器打开点我就可以直接添加配置(SSR版)</a>
                                    <br><br>
                                    <p class="subtitle">SSR订阅地址：</p>
                                    <a href={{ sub_link }}>点开后复制url至客户端的订阅处(如果你不知道这是什么请不要管!)</a>
                                </section>
                            </div>
                        </div>

                        <!--二维码部分 -->
                        <div class="modal" id="modal-{{ list.name }}">
                            <div class="modal-background"></div>
                            <div class="modal-card">
                                <header class="modal-card-head">
                                    <p class="modal-card-title">节点:
                                        <strong>{{ list.name }}</strong> 配置二维码</p>
                                </header>
                                <section class="modal-card-body">
                                    <div class="box">
                                        <!-- SSR配置 ... -->
                                        <p class="subtitle">SSR版本(推荐使用)：</p>
                                        <img src="" id="id-ssr-{{ list.node_id }}" width="256" height="256">
                                    </div>
                                    <div class="box">
                                        <!-- SS配置 ... -->
                                        <p class="subtitle">SS原版：</p>
                                        <img src="" id="id-ss-{{ list.node_id }}" width="256" height="256">
                                    </div>
                                </section>
                            </div>
                        </div>
                        <br>
                    </div>
                    {% endfor %}
                    <ul>
                        <p><a href="{% url 'shadowsocks:userinfo' %}">返回</a></p>
                    </ul>
                </div>
            </div>

            <!-- Footer -->
            <footer id="footer">
                <p class="copyright">&copy; Untitled. Design: <a href="https://html5up.net">HTML5 UP</a>.</p>
            </footer>
        </div>

		<!-- BG -->
        <div id="bg"></div>

        <!-- Scripts -->
        <script src="{% static 'sspanel/js/jquery.min.js' %}"></script>
        <script src="{% static 'sspanel/js/skel.min.js' %}"></script>
        <script src="{% static 'sspanel/js/util.js' %}"></script>
        <script src="{% static 'sspanel/js/main.js' %}"></script>
        <script>
        $(document).ready(function(){
            var buttons = $('.node-cell')

            buttons.each(function(index, element) {
                var node = $(element)
                // 找到节点id
                var nodeId = $(element).data('id')
                // 找到节点二维码img标签
                var ssr = node.find(`#id-ssr-${nodeId}`)
                var ss = node.find(`#id-ss-${nodeId}`)
                // 获取当前域名
                var host = window.location.host
                var protocol = window.location.protocol
                // 追加节点二维码
                ssr.attr("src", `${protocol}//${host}/qrcode/ssr/${nodeId}`)
                ss.attr("src", `${protocol}//${host}/qrcode/ss/${nodeId}`)
            })
        })
        </script>

	</body>
</html>
{% endblock main %}
